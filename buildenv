#!/bin/sh

#
# Set up environment variables for general build tool to operate
#
export ZOPEN_TYPE="TARBALL"
export ZOPEN_TARBALL_URL="https://ftp.wayne.edu/gnu/coreutils/coreutils-9.1.tar.gz"
export ZOPEN_TARBALL_DEPS="make gzip tar curl perl"
export ZOPEN_BOOTSTRAP="skip"
export ZOPEN_EXTRA_CPPFLAGS="-DSLOW_BUT_NO_HACKS=1 -DNO_ASM -qnose -I./,${PWD}/patches/PR2/include,${PWD}/coreutils-9.1/lib,/usr/include/le"
export ZOPEN_EXTRA_CONFIGURE_OPTS="--disable-dependency-tracking"

# Skip until port is completed
export ZOPEN_CHECK="skip"
export ZOPEN_INSTALL="skip"

zopen_check_results()
{
# Example check log file:
#
# TOTAL: 634
# PASS:  79
# SKIP:  189
# XFAIL: 0
# FAIL:  362
# XPASS: 0
# ERROR: 4
chk="$2_check.log"

totalTests=$(grep "^# TOTAL: " ${chk} | awk '{ print $3 }')
actualFailures=$(grep "^# FAIL: " ${chk} | awk '{ print $3 }')
actualPass=$(grep "^# PASS: " ${chk} | awk '{ print $3 }')
actualErrors=$(grep "^# ERROR: " ${chk} | awk '{ print $3 }')
actualSkip=$(grep "^# SKIP: " ${chk} | awk '{ print $3 }')
expectedFailures=362
expectedErrors=4
expectedPass=79
expectedSkip=189
totalExpectedFailures=$(($expectedFailures+$expectedErrors))
totalActualFailures=$(($actualFailures+$actualErrors))
expectedFailures=366
totalRunTests=$(($totalTests-$actualSkip))

cat <<ZZ
actualFailures:$totalActualFailures
totalTests:$totalRunTests
expectedFailures:$totalExpectedFailures
ZZ
}

zopen_post_install() 
{
   cd "$1/bin" && find . -type f ! -name "install" ! -name "md5sum" ! -name "mktemp" ! -name "tr" ! -name "readlink" ! -name "realpath" ! -name "sha1sum" ! -name "echo" -print | xargs rm 
}
